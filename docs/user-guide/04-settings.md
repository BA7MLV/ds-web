# 系统设置

## 概述

系统设置是 Deep Student 的核心配置中心，提供 AI 模型、外部服务、应用外观和数据管理等全方位的配置选项。

进入方式：点击应用顶部导航栏的齿轮图标，或使用快捷键打开命令面板选择“设置”。

设置页面采用左侧导航 + 右侧内容的布局。左侧导航栏顶部有**搜索框**，可按设置项名称或关键词过滤导航项，快速定位目标设置。包含以下标签页：
- **模型服务** - 管理 AI 供应商和模型配置
- **模型分配** - 为各功能场景分配合适的模型
- **应用设置** - 界面外观、语言、主题、记忆系统
- **MCP工具** - 管理 MCP 协议服务器
- **外部搜索** - 配置联网搜索引擎
- **数据统计** - 查看学习数据和使用统计
- **数据治理** - 备份、同步、审计、缓存管理
- **参数调整** - 聊天流式参数、搜索设置、PDF 阅读器、OCR 识别
- **快捷键** - 查看和自定义键盘快捷键
- **关于** - 版本信息和致谢

---

## 应用设置

应用设置用于配置界面外观、系统偏好和开发者选项。

### 语言设置

切换界面语言：
- **中文**：简体中文界面
- **English**：英文界面

切换后立即生效，无需重启应用。

### 全局界面缩放

调整整体界面的缩放比例（仅桌面端）：
- 可选比例：80% / 90% / 100% / 110% / 120% / 130% / 150%
- 点击"恢复 100%"重置为默认

**注意**：此功能调用 WebView 缩放，可能轻微影响清晰度。

### 全局字体

设置应用界面的全局字体：

| 分类 | 可选字体 |
|------|---------|
| 系统字体 | 系统默认 |
| 英文字体 | Inter、Roboto、Open Sans、Lato、Montserrat 等 |
| 中文无衬线 | 苹方/微软雅黑、思源黑体、鸿蒙黑体、OPPO Sans 等 |
| 中文衬线 | 思源宋体、宋体 |
| 手写字体 | 霞鹜文楷、楷体 |
| 等宽字体 | JetBrains Mono、Cascadia Code |

### 全局字号

调整界面文字的整体大小：
- 可选比例：85% / 90% / 100% / 110% / 120% / 130%
- 点击“恢复默认”重置为 100%

### 主题调色板

选择界面主题色：
- **极光蓝**：深邃蓝调（默认）
- **薰衣紫**：优雅紫色调
- **森林绿**：自然绿色调
- **日落橙**：温暖橙色调
- **玫瑰粉**：柔和粉色调
- **青碧色**：清新青色调
- **柔和色调**：低饱和度配色
- **纸纹质感**：仿纸质背景

点击色彩圆点即可切换，切换后立即生效。

### 开发者选项

#### 顶部栏边距
调整顶部栏的顶部边距高度（px），用于为安卓状态栏预留空间。

#### 调试面板
点击"打开"按钮可打开统一调试面板，用于调试全局流式会话与事件。

#### 调试日志总开关
关闭后，前端控制台不输出调试日志（包含 MCP 连接、Chat V2/技能/工作区日志、页面生命周期追踪）。需要排查问题时再开启。

#### 日志查看
1. 选择日志类型（后端/前端/调试/崩溃）
2. 点击"打开日志文件夹"查看日志文件

#### 显示消息请求体
开启后，AI 对话中每条助手消息下方会显示完整的 API 请求体，便于调试。

#### Sentry 错误报告
开启后，应用崩溃和错误信息会上报到 Sentry 平台以改善产品质量。默认**关闭**（遵守隐私合规要求）。

### Anki 连接

启用与 Anki 桌面端的连接（AnkiConnect 快捷开关）：
- **开关**：允许 Deep Student 通过 AnkiConnect 推送卡片到本机 Anki
- **关闭**：禁用同步，仅支持导出 APKG 文件

详细的 AnkiConnect 状态检查和端口配置，请在**制卡任务**侧边栏中点击 **AnkiConnect 设置**。

### 记忆系统

配置 AI 记忆的存储位置：
1. 从下拉列表选择一个笔记文件夹作为记忆根目录
2. 或点击"新建文件夹"创建新的记忆文件夹
3. 配置完成后显示"✓ 记忆系统已配置"

---

## 模型服务（API 配置）

模型服务用于管理 AI 服务供应商及其模型。采用"供应商 → 模型"的层级结构，同一供应商下的模型可复用 API 密钥和接口地址。

### 供应商管理

#### 添加供应商

1. 在左侧供应商列表上方，点击 **+** 按钮
2. 在弹出的对话框中填写：
   - **名称**：供应商的显示名称
   - **接口地址**：API 的基础 URL（如 `https://api.openai.com/v1`）
   - **备注**（可选）：供应商的说明信息
3. 点击保存

#### 配置 API 密钥

选中供应商后，在右侧面板中：
1. 找到"API 密钥"区域
2. 输入 API Key 后会自动保存
3. 可点击眼睛图标显示/隐藏密钥
4. 可点击清除按钮移除已保存的密钥

#### SiliconFlow 快速配置

SiliconFlow（硅基流动）供应商提供一键配置功能：
1. 选中 SiliconFlow 供应商
2. 在 API 密钥区域输入 SiliconFlow API Key
3. 点击"一键分配"按钮
4. 系统自动创建以下预设模型配置并完成分配：

| 功能 | 预设模型 |
|------|---------|
| 对话 / 题库AI批改 | `deepseek-ai/DeepSeek-V3.2` |
| Anki 制卡 | `Qwen/Qwen3-30B-A3B-Instruct-2507` |
| 嵌入（RAG） | `BAAI/bge-m3` |
| 重排序 | `BAAI/bge-reranker-v2-m3` |
| 标题/标签生成 | `inclusionAI/Ling-mini-2.0` |
| 翻译 | `tencent/Hunyuan-MT-7B` |
| OCR（默认） | `PaddlePaddle/PaddleOCR-VL-1.5` |

#### 编辑和删除供应商

- 选中供应商后，点击右侧面板的"编辑"按钮可修改供应商信息
- 点击"删除"按钮可删除供应商（关联的模型配置会一并删除）
- **注意**：内置供应商无法删除

#### 调整供应商顺序

通过拖拽供应商列表项可调整显示顺序。SiliconFlow 供应商始终置顶显示。

### 模型管理

#### 添加模型

1. 选中目标供应商
2. 在"模型列表"区域点击"添加模型"按钮
3. 填写模型配置：
   - **显示名称**：模型的友好名称
   - **模型标识**：实际调用的模型 ID（如 `gpt-4o`）
   - **模型能力**：勾选模型支持的能力
     - 多模态模型：支持图片输入
     - 推理模型：支持思维链推理
     - 嵌入模型：用于向量嵌入
     - 重排序模型：用于搜索结果重排序
     - 支持工具调用：支持 function calling
4. 点击保存

#### 模型操作

每个模型卡片提供以下操作：
- **开关**：启用/禁用该模型配置
- **星标**：收藏模型（收藏的模型会优先显示）
- **编辑**：修改模型配置参数
- **测试**：测试 API 连接是否正常
- **删除**：移除模型配置

#### 模型高级参数

展开模型编辑面板可配置高级参数：
- **Temperature**：控制输出随机性（0-2）
- **最大输出 Token**：单次生成的最大令牌数
- **推理参数**：针对推理模型的 thinking/reasoning 配置
- **供应商特定参数**：如 Anthropic 的 thinking_budget、Google 的 thinkingBudget 等

---

## 模型分配

模型分配页面用于为 Deep Student 的各项 AI 功能指定使用的模型。

### 核心模型

| 功能 | 说明 | 推荐模型类型 |
|------|------|-------------|
| **对话模型** | 用于 AI 对话、题目解答和交互 | 推荐推理能力强的模型 |

### 功能增强模型

| 功能 | 说明 | 是否必选 |
|------|------|---------|
| **Anki制卡模型** | 用于智能生成问答卡片 | 可选，默认使用对话模型 |
| **标题/标签生成模型** | 生成聊天标题和智能标签 | 可选，默认使用对话模型 |
| **翻译专用模型** | 文本翻译功能 | 可选，默认使用对话模型 |
| **题库AI批改模型** | 题目集中 AI 评分与解析 | 可选，默认使用对话模型 |

### RAG 与知识库模型

| 功能 | 说明 | 是否必选 |
|------|------|---------|
| **嵌入模型** | 用于 RAG 知识库的向量嵌入，需要 embedding 类型的模型 | 使用 RAG 检索必须配置 |
| **重排序模型** | 对检索结果进行重排序，提升检索准确性 | 可选 |
| **多模态重排序模型** | 对多模态 RAG 检索结果进行重排序 | 可选 |

### 分配操作

1. 在每个功能卡片中点击下拉选择器
2. 从已启用的模型列表中选择合适的模型
3. 选择后自动保存

**提示**：选择后自动保存，无需手动确认。

### 嵌入维度管理

用于管理 RAG 知识库的向量嵌入配置：

1. 点击"创建维度"添加新的嵌入维度
2. 输入维度值（如 1024、1536）并选择模态类型（文本/多模态）
3. 分配对应的嵌入模型
4. 可将某个维度设为默认

维度管理页面显示：
- 维度数量和总记录数统计
- 每个维度的关联模型和数据量
- 维度状态（正常/空/模型缺失）

### OCR 引擎配置

选择题目集识别使用的 OCR 引擎：

1. 查看当前引擎状态
2. 从已配置的 OCR 模型中选择引擎

**提示**：使用 SiliconFlow 一键分配可自动配置 OCR 模型。

如果配置了多个 OCR 引擎，可展开"引擎对比测试"面板进行效果对比。

### 配置状态检查

页面底部显示各功能的配置状态：
- ✅ 绿色勾号：已配置
- ⚠️ 黄色警告：可选项未配置
- ❌ 红色叉号：必选项未配置

配置状态检查包括：对话模型、Anki制卡模型（可选）、重排序模型（可选）、标题/标签生成模型（可选）、翻译专用模型（可选）、题库AI批改模型（可选）、题目集 OCR 模型（可选）。

当对话模型配置完成后，会显示"基础功能配置完成"的提示。

> ⚠️ 若对话模型未配置，Chat V2 将阻止发送并给出直达"模型分配"的引导。

---

## MCP 工具

MCP（Model Context Protocol）工具用于扩展 AI 的能力，让 AI 可以调用外部工具和服务。

### 概览统计

页面顶部显示：
- **连接状态**：已连接/总服务器数
- **工具缓存**：已缓存的工具数量
- **提示/资源**：Prompts 和 Resources 数量
- **缓存更新时间**：最近一次缓存刷新时间

### 服务器管理

#### 添加预置服务器

1. 点击"添加预置"按钮
2. 从预置列表中选择服务器：
   - **Context7**：获取任意编程库的最新文档和代码示例（免费，无需 API Key）
3. 点击"启用"按钮添加

#### 手动添加服务器

1. 点击"新增 MCP 工具"按钮
2. 选择编辑模式（图形表单或 JSON 配置）
3. 填写服务器配置：
   - **服务器名称**：显示名称
   - **传输类型**：SSE / WebSocket / HTTP / Stdio
   - **服务器 URL** 或 **命令+参数**（根据传输类型）
   - **命名空间**（可选）：工具前缀
   - **API Key**（可选）：身份验证密钥
   - **环境变量**（可选）：KEY=value 格式
4. 点击"新建"保存

#### 服务器操作

鼠标悬停在服务器列表项上显示操作按钮：
- **预览**：查看服务器详情和工具列表
- **测试**：测试服务器连接
- **编辑**：修改服务器配置
- **删除**：移除服务器

### 快捷操作

点击"快捷操作"下拉菜单：
- **重新连接**：重新建立与所有服务器的连接
- **刷新清单**：刷新工具/提示/资源列表
- **体检**：检查所有服务器的连接状态
- **清空缓存**：清除本地缓存的工具信息
- **安全策略**：配置工具调用的安全策略

### 内置服务器

Deep Student 内置了部分 MCP 服务器，提供：
- 笔记读写工具
- 知识库搜索工具
- 记忆管理工具
- Anki 卡片生成工具

内置服务器显示"内置"标签，无法删除或编辑。

---

## 外部搜索

外部搜索设置用于配置 AI 对话中的联网搜索能力。

### 默认搜索引擎

在顶部选择默认使用的搜索引擎。只有已配置密钥的引擎才能被选择。

### 搜索引擎配置

展开各引擎卡片进行配置：

#### Google CSE（自定义搜索）
- **Google API Key**：Google Cloud 的 API 密钥
- **CSE CX**：自定义搜索引擎 ID
- 需要在 Google Cloud Console 创建项目并启用 Custom Search API

#### SerpAPI
- **SerpAPI Key**：SerpAPI 账户的 API 密钥
- SerpAPI 是付费服务，按搜索次数计费

#### Tavily
- **Tavily Key**：Tavily 账户的 API 密钥
- Tavily 专为 AI 应用优化，提供结构化搜索结果

#### Brave Search
- **Brave Key**：Brave Search API 密钥
- Brave 提供隐私优先的搜索服务

#### SearXNG
- **SearXNG Endpoint**：SearXNG 实例的地址
- **SearXNG Key**（可选）：API 密钥
- 可使用公共实例或自建实例

#### 智谱 AI 搜索
- **智谱 API Key**：智谱开放平台的 API 密钥
- 专为中文优化，支持意图识别和时间过滤

#### 博查 AI 搜索
- **博查 API Key**：博查平台的 API 密钥
- 专为 AI 应用设计，提供高质量中文搜索结果

### 测试连接

每个引擎卡片都提供"测试可用性"按钮，点击可验证配置是否正确。

### 高级搜索配置

点击"高级搜索功能"展开更多选项：

#### 搜索结果重排器
- 启用后使用 LLM 对搜索结果进行语义重排
- 可配置重排数量（Top-K）

#### 中文可信站点模板
- 启用后优先检索权威中文站点
- 可使用默认白名单或自定义站点列表

#### Provider 策略矩阵
- 为不同搜索引擎配置独立的超时、并发、限流策略
- 可配置缓存时长和最大条目数

### 注入文本设置

配置搜索结果注入到 AI 上下文的方式：
- **单条摘要最大字符数**：每条结果的截断长度（默认 180）
- **注入文本总长度上限**：汇总文本的最大长度（默认 1900）

### 站点过滤

- **白名单站点**：仅搜索这些站点的内容
- **黑名单站点**：排除这些站点的内容

---

## 数据统计

数据统计页面展示学习数据和应用使用情况的可视化统计。

### 主要功能

- **学习时长统计**：按日/周/月查看学习时长
- **对话统计**：查看会话数量和消息数量
- **学习热力图**：可视化展示学习活跃度

---

## 数据治理

数据治理提供数据库状态监控、备份恢复、同步管理和审计日志功能。

### 概览

显示系统数据库的整体状态：
- **全局版本**：数据库架构版本号
- **健康状态**：整体健康状况
- **数据库数量**：已初始化的数据库数量

#### 数据库状态列表

| 列 | 说明 |
|----|------|
| 数据库 | 数据库名称 |
| 版本 | Schema 版本号 |
| 状态 | 健康/异常 |
| 依赖 | 依赖项是否满足 |
| 问题 | 存在的问题描述 |

点击"运行健康检查"可重新检测所有数据库状态。

### 备份管理

#### 快速备份

- **完整备份**：备份所有数据库和配置
- **增量备份**：仅备份自上次备份以来的变更

#### 分层备份

按优先级选择要备份的数据层级：
- **核心数据 (P0)**：数据库和配置
- **重要数据 (P1)**：+ 笔记资源
- **可重建数据 (P2)**：+ 向量索引
- **大型资产 (P3)**：+ 图片/文档/视频

可选择性包含资产文件并指定资产类型。

#### ZIP 管理

- **导出为 ZIP**：将备份导出为 ZIP 文件
- **从 ZIP 导入**：从 ZIP 文件恢复数据
- **压缩级别**：0（无压缩）到 9（最大压缩）

#### 备份列表

显示已创建的备份，每个备份可执行：
- **验证**：检查备份完整性
- **导出**：导出为 ZIP
- **恢复**：恢复此备份
- **删除**：删除备份文件

### 同步状态

显示数据同步状态：
- **待同步变更**：等待同步的变更数量
- **已同步变更**：已完成同步的变更数量
- **设备 ID**：当前设备的唯一标识

#### 冲突检测

点击"检测冲突"检查多设备同步冲突，发现冲突后可选择解决策略：
- **保留最新**：按时间戳自动选择较新的数据（推荐）
- **保留本地**：以本地数据为准
- **使用云端**：以云端数据覆盖本地
- **手动处理**：暂不处理，稍后逐条解决

### 审计日志

记录所有数据操作的日志：

| 列 | 说明 |
|----|------|
| 时间 | 操作时间 |
| 操作 | 迁移/备份/恢复/同步 |
| 目标 | 操作对象 |
| 状态 | 已完成/失败/进行中/部分完成 |
| 耗时 | 操作耗时 |

可按操作类型和状态筛选日志。

### 数据迁移

提供聊天记录等数据的迁移功能。

---

## 参数调整

参数调整页面用于配置系统运行参数、搜索设置、PDF 阅读器和 OCR 识别策略。

### 聊天流式参数

- **流式超时时间**：设置流式响应的超时秒数
- **自动取消**：超时后是否自动取消请求

### 搜索设置

- **语义检索使用 FTS 预筛**：开启后先用全文搜索快速筛选候选，再做语义相似度匹配

### PDF 阅读器设置

#### 渲染性能
- **最大像素比**：限制渲染分辨率（1.0-3.0）
- **滚动时降级渲染**：滚动时使用低分辨率
- **预渲染行数**：可视区域外预渲染的页数

#### 文本层
- **默认启用文本选择**：关闭可提升性能
- **文本层渲染范围**：当前页 ± N 页

#### 批注层
- **默认启用批注层**：显示 PDF 内嵌的链接、表单等
- **批注层渲染范围**：当前页 ± N 页

#### 缩略图
- **缩略图宽度**：侧边栏缩略图的像素宽度
- **缩略图像素比**：缩略图渲染分辨率

#### 默认视图
- **默认缩放**：打开 PDF 时的初始缩放比例
- **默认视图模式**：单页或双页并排

### OCR 识别设置

配置文件上传时的自动文字识别策略：

#### 基本设置
- **启用自动 OCR**：总开关
- **多模态模型跳过 OCR**：当聊天模型支持图片理解时跳过 OCR

#### 图片识别
- **图片自动 OCR**：上传图片时自动识别文字

#### PDF 识别
- **扫描版 PDF 自动 OCR**：文本少于阈值时自动 OCR
- **PDF 文本阈值**：判定为扫描版的字符数阈值

---

## 快捷键

快捷键设置页面用于查看和自定义命令面板的键盘快捷键。

### 常用快捷键

- **新建对话**：快速创建新的聊天会话
- **搜索**：打开搜索功能
- **切换侧边栏**：显示/隐藏侧边栏

---

## 关于

关于页面展示应用信息和致谢。

### 技术合作伙伴致谢

展示为 Deep Student 提供服务支持的合作伙伴：
- **SiliconFlow**：提供多模态与推理模型服务

### 开源项目致谢

列出 Deep Student 使用的主要开源项目和框架。

### 开发信息

| 项目 | 信息 |
|------|------|
| 开发者 | DeepStudent Team |
| 版本 | 当前版本号 |
| 许可证 | AGPL-3.0-or-later |
| 平台支持 | Windows / macOS / iPadOS / Android |

### 官方链接

- 访问官网
- GitHub 仓库
- Issue 反馈
- 隐私政策

---

## 常见问题

### API 配置相关

**Q: 如何快速开始使用？**

A: 推荐使用 SiliconFlow 一键配置：
1. 注册 SiliconFlow 账号并获取 API Key
2. 在模型服务中选择 SiliconFlow 供应商
3. 输入 API Key 后点击"一键分配"
4. 系统会自动配置并分配所有必要的模型

**Q: 测试 API 连接失败怎么办？**

A: 请检查：
1. API Key 是否正确
2. 接口地址是否正确（注意不要遗漏 `/v1` 后缀）
3. 网络是否能访问该 API 服务
4. 账户余额是否充足

**Q: 如何使用自定义/代理 API？**

A: 添加新供应商时，在"接口地址"中填写代理服务的地址即可。常见格式如：
- `https://your-proxy.com/v1`
- `http://localhost:8080/v1`

### 模型分配相关

**Q: 对话模型如何选择？**

A: 对话模型是 Deep Student 的核心 AI 模型，用于所有对话、题目解答和交互。推荐使用推理能力强的模型（如 DeepSeek-V3.2、Claude Sonnet 4 等）。如果需要图片理解能力，请选择支持多模态的模型。

**Q: 配置状态显示"未配置"但我已经选择了模型？**

A: 请确认：
1. 选择的模型配置已启用（开关打开）
2. 模型所属的供应商已配置 API Key
3. 点击"测试"按钮验证模型可用

### 外部搜索相关

**Q: 哪个搜索引擎最推荐？**

A: 根据使用场景推荐：
- 国内用户：智谱 AI 搜索或博查 AI 搜索（中文优化）
- 免费方案：SearXNG（使用公共实例）
- 付费方案：Tavily（AI 优化）或 Google CSE（覆盖最广）

**Q: 搜索结果质量不好怎么办？**

A: 可以尝试：
1. 启用搜索结果重排器（需配置重排序模型）
2. 配置中文可信站点模板
3. 使用站点白名单限定权威来源
4. 调整单条摘要长度和总长度上限

### 数据治理相关

**Q: 多久应该备份一次？**

A: 建议：
- 重要数据变更后立即备份
- 日常使用每周至少完整备份一次
- 导出重要备份为 ZIP 文件存储到外部位置

**Q: 恢复备份后数据丢失怎么办？**

A: 系统在恢复前会自动创建"预恢复备份"，可以在备份列表中找到并恢复到恢复操作之前的状态。
