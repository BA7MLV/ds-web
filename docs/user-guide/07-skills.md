# 技能系统

## 概述

技能系统 (Skills) 是 Deep Student 的可扩展 AI 能力增强机制，基于 SKILL.md 规范设计。通过激活不同的技能，AI 可获得特定的行为模式、专业指令和工具能力。

**核心原则**：工具不全量加载，而是通过技能**按需注入**，减少无关工具占用上下文 Token。

### 技能的两个组成部分

1. **系统提示词 (Content)**：定义 AI 在该技能下的行为模式和工作流程
2. **内嵌工具 (Embedded Tools)**：技能激活时注入到 AI 上下文的工具集合

---

## 快速开始

### 激活技能

1. 点击输入栏底部工具栏中的 **技能按钮**（闪电图标）
2. 在弹出的技能选择面板中选择要激活的技能
3. 可同时激活多个技能

### 取消激活

点击已激活技能标签上的关闭按钮即可移除单个技能。

---

## 内置技能

Deep Student 提供以下内置技能，分为**指令型技能**（主要改变 AI 行为）和**工具组技能**（提供工具能力）两类。

### 指令型技能

这些技能包含详细的系统提示词，让 AI 以专业方式处理特定场景：

#### `deep-student` — 深度学者（默认开启）

**自动在每个新会话中激活**。Deep Student 的默认策略技能，使 AI 具备持久记忆能力。

- **主动回忆**：每次对话开始前，自动搜索相关记忆了解用户背景和偏好
- **积极记录**：对话中出现有复用价值的信息时，主动写入长期记忆
- **本地优先**：优先检索本地知识库和记忆，再考虑联网搜索
- **轻量确认**：只在真正有歧义时才用 Ask User 确认，已有记忆时直接执行

硬依赖（自动加载）：`knowledge-retrieval`、`vfs-memory`、`ask-user`

软关联（按需加载）：`learning-resource`、`mindmap-tools`、`web-fetch`、`attachment-tools`

#### `tutor-mode` — 导师模式

苏格拉底式学习导师，通过引导式提问帮助学生理解知识，而非直接给答案。

工作原则：
- 了解学习者背景后，将新概念建立在已知知识之上
- 通过提示、微步骤和追问让学习者自己发现解法
- 每轮最多一个问题，让学习者完整响应后再继续
- 不替做需要评分的作业，提供平行示例和分步指导

无内嵌工具（纯指令型）。

#### `chatanki` — ChatAnki 制卡

端到端制卡闭环。将 PDF/图片/截图/手写/Markdown 等材料自动转成高质量 Anki 卡片。

工作流程：`chatanki_run/start` → `chatanki_wait` → `chatanki_export/sync`

内嵌工具包括：chatanki_run、chatanki_start、chatanki_status、chatanki_wait、chatanki_control、chatanki_export、chatanki_sync、chatanki_list_templates、chatanki_analyze、chatanki_check_anki_connect

依赖：`ask-user`（制卡前用于确认偏好）

详见 [Anki 智能制卡](./03-chatanki.md)。

#### `literature-review` — 文献综述助手

专业学术文献综述助手，系统化完成文献调研、整理和综述撰写。

五阶段工作流：选题与范围界定 → 文献检索（arXiv/OpenAlex/本地） → 文献筛选与评价 → 信息提取与整理 → 综述撰写

依赖工具组：`knowledge-retrieval`、`academic-search`、`todo-tools`、`canvas-note`、`web-fetch`、`learning-resource`，可选 `vfs-memory`

#### `research-mode` — 调研模式

系统化调研助手，使用 todo 工具管理进度，网络搜索收集信息，笔记工具整理报告。

必须先用 Ask User 确认调研深度偏好、输出格式偏好和关注重点，再创建任务清单。

依赖工具组：`knowledge-retrieval`、`todo-tools`、`canvas-note`、`web-fetch`、`ask-user`

---

### 工具组技能

这些技能主要提供工具能力，通常由指令型技能（如 `research-mode`）通过 `relatedSkills` 自动加载，也可手动激活：

| 技能 ID | 名称 | 工具功能 |
|---------|------|----------|
| `knowledge-retrieval` | 知识检索 | RAG 检索（本地文档）、记忆搜索、网络搜索、统一搜索 |
| `canvas-note` | 智能笔记 | 创建/读取/追加/替换/搜索笔记 |
| `vfs-memory` | 记忆管理 | 写入/读取/更新/删除/智能写入/列举长期记忆 |
| `ask-user` | 用户提问 | 向用户发起选择式提问（3 选项 + 自定义输入，30 秒超时自动选推荐项） |
| `mindmap-tools` | 思维导图 | 创建导图、更新节点、导出 |
| `todo-tools` | 任务管理 | 初始化任务清单、添加/更新/查询任务 |
| `web-fetch` | 网页抓取 | 抓取并解析指定 URL 的完整网页内容 |
| `learning-resource` | 学习资源 | 列举/读取/搜索学习资源和文件夹 |
| `template-designer` | 模板设计师 | 列举、查看、创建、更新、分叉、预览和删除 Anki 制卡模板 |
| `qbank-tools` | 智能题库 | 创建题目、练习模式、模拟考试 |
| `workspace-tools` | 协作工作区 | 工作区管理、多代理协调与日志 |
| `subagent-worker` | 子代理 | 将子任务分派给子代理并汇总结果 |
| `attachment-tools` | 附件解析 | 上传文件、提取文本/元信息 |
| `academic-search` | 学术论文搜索 | arXiv 搜索、OpenAlex 学术搜索（2.4 亿+篇，国内可直连）、论文 PDF 下载保存、引用格式化（BibTeX/APA/GB-T）|
| `docx-tools` | Word 文档 | DOCX 文档读写编辑（结构读取、表格提取、文本替换） |
| `pptx-tools` | PPT 演示 | PPTX 读写编辑（幻灯片读取、文本替换） |
| `xlsx-tools` | Excel 表格 | XLSX 读写编辑（单元格编辑、表格提取） |

---

## 技能管理

### 进入技能管理页面

技能管理是独立的视图页面，不在设置中。

**入口**：
1. 点击侧边栏导航中的 **技能管理** 图标（闪电图标，位于"学习资源"和"制卡任务"之间）
2. 或使用命令面板：按 `⌘K` / `Ctrl+K`，搜索"技能管理"

### 技能列表

技能管理页面左侧显示所有可用技能：

- **内置技能**：系统预设，不可删除，但可自定义指令内容
- **全局技能**：存储在 `~/.deep-student/skills/` 的用户技能
- **项目技能**：存储在项目 `.skills/` 目录的项目级技能

### 查看技能详情

点击技能卡片查看：
- **元数据**：ID、名称、描述、版本、作者
- **指令内容**：系统提示词（Markdown 格式）
- **内嵌工具**：技能携带的工具列表

说明：版本号显示依赖技能元数据中的 `version` 字段，未填写则不显示。

### 编辑内置技能

内置技能可自定义，但不修改原始文件：
1. 选择一个内置技能，点击 **编辑**
2. 修改指令内容或元数据
3. 点击 **保存**，自定义版本覆盖内置版本
4. 如需恢复，点击 **恢复默认**

---

## 创建自定义技能

### 通过技能管理页面创建

1. 点击技能列表顶部的 **"+"** 按钮
2. 填写元数据（ID、名称、描述）
3. 编写指令内容（Markdown 格式）
4. 点击 **创建** 保存

### 技能文件格式（SKILL.md）

技能文件采用 YAML frontmatter + Markdown 格式：

> **注意**：技能 ID 由文件名决定（如 `my-study-helper.SKILL.md`），frontmatter 中**不含 `id` 字段**。`name` 字段是技能标识符（英文），Markdown 正文的一级标题作为显示名称。

```yaml
---
name: my-study-helper
description: 帮助制定学习计划和追踪进度，适用于备考、自学等场景
version: 1.0.0
author: Your Name
priority: 3
---

# 学习助手

你是一个专业的学习规划师，擅长：

1. 制定科学的学习计划
2. 追踪学习进度
3. 提供学习方法建议
```

**frontmatter 字段说明**：

| 字段 | 类型 | 说明 |
|------|------|------|
| `name` | 字符串 | 技能标识符（小写字母、数字、连字符），必填，同文件名（不含扩展名） |
| `description` | 字符串 | 功能描述，用于 AI 自动发现，建议 50+ 字 |
| `version` | 字符串 | 版本号（如 `1.0.0`） |
| `author` | 字符串 | 作者名 |
| `priority` | 数字 | 加载优先级（数字越小越先加载） |
| `skillType` | 枚举 | `standalone`（默认）或 `composite`（整合型） |
| `relatedSkills` | 数组 | 整合型技能关联的工具组 ID |
| `dependencies` | 数组 | 硬依赖技能（激活时自动加载） |
| `disableAutoInvoke` | 布尔 | 是否禁用自动激活，默认 `false` |

### 高级：禁用自动激活

某些需要谨慎使用的技能可设置为手动激活：

```yaml
---
name: dangerous-tool
disableAutoInvoke: true
---
```

### 技能存储位置

| 类型 | 存储位置 | 说明 |
|------|----------|------|
| 全局技能 | `~/.deep-student/skills/` | 所有项目共享 |
| 项目技能 | `.skills/` | 生产环境默认映射到应用数据目录 |

项目技能优先级高于全局技能，同 ID 时覆盖。

---

## 默认技能

可在技能管理页面将技能设为**默认**，新会话创建时自动激活。

**注意**：`deep-student` 技能已内置为默认启用，无需手动设置。如果你创建了其他想要默认激活的技能（如自定义的学习助手），在技能卡片上点击 "**设为默认**" 按钮（勾选图标）即可。

---

## 与 MCP 工具的关系

| 类型 | 来源 | 加载时机 |
|------|------|----------|
| MCP 外部工具 | 外部 MCP 服务器（在设置中配置） | 连接时全量加载 |
| 技能内嵌工具 | 技能的 `embeddedTools` 字段 | 技能激活时按需加载 |
| 内置工具组 | `builtin-*` 技能 | 技能激活时按需加载 |

技能是更高层的抽象：
- 只包含系统提示词 → 改变 AI 行为（如 `tutor-mode`）
- 只包含工具 → 提供能力（如 `canvas-note`）
- 同时包含两者 → 行为 + 能力（如 `chatanki`、`literature-review`）

---

## 常见问题

### Q: 技能和 MCP 工具有什么区别？
A: 技能是更高层的抽象，包含系统提示词和工具配置。MCP 工具是底层能力单元。技能通过"渐进披露"机制按需加载工具，而 MCP 工具在服务器连接时全量加载。

### Q: `deep-student` 可以关闭吗？
A: 可以在对话中点击技能标签的关闭按钮关闭它。但由于它是默认技能，下次新建会话时会再次自动激活。

### Q: 如何让 AI 自动选择合适的技能？
A: AI 会根据 `<available_skills>` 元数据推荐技能。你也可以在对话中描述需求，AI 会建议激活相关技能。

### Q: 自定义技能保存在哪里？
A: 自定义技能保存在 `~/.deep-student/skills/` 目录下。内置技能的自定义版本保存在应用数据库中。

### Q: 如何分享技能给其他人？
A: 将技能导出为 `.SKILL.md` 文件，分享给其他用户导入即可。

### Q: 激活多个技能会冲突吗？
A: 一般不会。多个技能的指令会合并注入上下文，工具也会合并可用。但如果指令存在矛盾，可能影响 AI 行为。建议复合型技能（如 `literature-review`）与其他指令型技能分开使用。

### Q: 为什么有些工具需要激活技能才能使用？
A: 这是"渐进披露"设计——全量加载所有工具会占用大量上下文 Token，影响 AI 理解能力。按需加载可减少 Token 消耗、提高 AI 专注度、降低工具调用错误率。

---

*最后更新：2026-02-27*
